# -*- coding: utf-8 -*-
<!DOCTYPE html>

<!--[if lt IE 7 ]> <html lang="en" class="ie ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="ie ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="ie ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="ie ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> 
<html lang="en"> 
<!--<![endif]-->
<head>  

<meta charset="utf-8" /> 

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <!-- <title>DataFinder</title> -->
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="/static/foundation/stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="/static/foundation/stylesheets/foundation.min.css">
  <link rel="stylesheet" href="/static/foundation/stylesheets/app.css">

  <!-- Foundation css customised for DataFinder   -->
  <link rel="stylesheet" href="/static/foundation/stylesheets/foundation_enhance.css">

  <script src="/static/foundation/javascripts/modernizr.foundation.js"></script>

  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
   <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
   <script src="http://datafinder-d2v.bodleian.ox.ac.uk:8080/js/piwik.js"></script>
  <!-- Included JS Files (Compressed) -->
  <script src="/static/foundation/javascripts/jquery.js"></script>
  <script src="/static/foundation/javascripts/foundation.min.js"></script>
  
  <!-- Initialize JS Plugins -->
  <script src="/static/foundation/javascripts/app.js"></script>
  <script src="http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=places"></script>
  <script src="/static/js/geocomplete.js"></script>


   <style>
	.ui-autocomplete {
	max-height: 100px;
	overflow-y: auto;
	/* prevent horizontal scrollbar */
	overflow-x: hidden;
	}
	/* IE 6 doesn't support max-height
	* we use height instead, but this forces the menu to always be this tall
	*/
	* html .ui-autocomplete {
	height: 100px;
	}
  </style>

  <script src="http://code.jquery.com/ui/1.8.2/jquery-ui.js"></script>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.2/themes/smoothness/jquery-ui.css" />
  <script>
    // $(window).load(function(){
    // $("#featured").orbit();
    // });
    </script> 
 <!-- <script type="text/javascript" src="/static/jquery.js"></script> -->

  ${self.head_tags()}
  
 <script type="text/javascript">

  $(document).ready( function() {
   var projects = {}
   var $=jQuery.noConflict(); 
   $("#single_temporal_date").datepicker();
   $("#start_date_range").datepicker();
   $("#end_date_range").datepicker();
   
   $("#data_collected_single_temporal_date").datepicker();
   $("#data_collected_start_date_range").datepicker();
   $("#data_collected_end_date_range").datepicker();
   
   $("#embargo_end_date").datepicker();
   
   
   var myDate = new Date();
   var prettyDate = myDate.getDate() + '/' + (myDate.getMonth()+1) + '/' + myDate.getFullYear();
   $("#embargo_end_date").val(prettyDate);
     
   
 /*  $("select#publication_year option").each(function(){
    for(i=1971; i<=2020; i++){
    	$("select#publication_year").append(i);}
});*/
//isssue the trigger to reflect the dynamically added change to the select
  var myDate = new Date(); 
  currentYear = myDate.getFullYear(); 
  % if solr_response:
  		% for df_record in solr_response['docs']:
  			% if 'issued' in df_record:
  				currentYear = "${df_record['issued'][0]}"	  			
  			% endif	
  		% endfor
   % endif	
  for(i=1970; i<=2020; i++)
	{	

	  if (currentYear == i)
	   {
	       $("<option/>")
	       .attr("value", i)
	       .attr("selected",true)
	       .text(i)
	       .appendTo('#publication_year');
	   }
	   else
	   {    
	     $("<option/>")
	       .attr("value", i)
	       .text(i)
	       .appendTo('#publication_year');
	   }
	   	  
    } 
  $("#publication_year").trigger("change");
 
   
  $("#geo_location").geocomplete({
  	 map: ".map_canvas", 
  	 markerOptions: { draggable: true }, 	 
  	 details: "div",
     detailsAttribute: "data-geo",
   });
    
  //$("#geo_location").geocomplete({
  //	 map: ".map_canvas",
  //	 markerOptions: { draggable: true } 	
  // });
   
  $("#geo_location").bind("geocode:dragged", function(event, latLng){
          $("input[name=lat]").val(latLng.lat());
          $("input[name=lng]").val(latLng.lng());
          $("#reset").show();
  });
        
        
  $("#reset").click(function(){
          $("#geo_location").geocomplete("resetMarker");
          $("#reset").hide();
          return false;
   });

  
  // $("#publication_year").css("display", "block");
  // Refresh the select to match the new state of the select to show the dynamically added options
  //$('#publication_year').selectpicker('refresh');

  setUpExamplePage();
  setUpPage();
  
  $('#save').click( function()
	{
	    var actionURL = "/admin/save_source/";
	    $('#form1').attr('action', actionURL);  
	    $("#form1")[0].submit();    
	});

	var availableTags = ['proj 1','proj 2'];
	$( "#pproject_name" ).autocomplete({
	source: availableTags
	});

    
   $("#project_name").autocomplete({
   
     //if ($(this).val().length >= 2 ) {
		  
			source: function( request, response ) 
			{	var list;	 
			  	 $.ajax({
			      url: "/contribute/projects/",
			      type: "POST",
			      data: "{'Project_ID':'1'}",
			      contentType: "application/json",
                  dataType: "json",
			      success: function(data)
				      {  projects = data;
				         var keys=[];
				         for( var key in data)
				         {
				            keys.push(key);
				         }
				         response( keys);
				      },
			      error:function()
				      {
				          alert("failure");
				      }   
			    });
		    },
		    select: function(event,ui) 
		    {   var key = ui.item.value;
		        var proj_data = projects[key];
		    	$("#project_desc").val(proj_data['desc']);
		     	$("#project_website").val(proj_data['website']);
		     	return true;
		    }   
			    
	 });


	 $("#main_language").autocomplete({
			source: function( request, response ) 
			{	 var list;	 
			     //if(request.term.length >= 2)
			  	 //{
				  	  $.ajax({
				      url: "/contribute/languages/?lang="+request.term,
				      type: "GET",
				      data: "{'Project_ID':'1'}",
				      contentType: "application/json",
	                  dataType: "json",
				      success: function(data)
					      {
					         response( data);
					      },
				      error:function()
					      {
					          alert("failure");
					      }   
					  });
				 //}
		    } 	
	 }); 
	 

	var funders = [
							"AcademyofScienceofSouthAf",
							"B.P.InternationalLtd",
							"C.LouisMeyerFamilyFoundati",
							"D.Swarovski&amp;Co.",
							"E.H.LaneFoundation",
							"F.M.KIRBYFOUNDATION",
							"1675 Foundation",
							"973 Programme of China"
				  ];
						
	jQuery("div :input[id^='funding_agency']").live("focus.autocomplete", null, function () {
	        var thisEl = jQuery(this);
	        thisEl.autocomplete({ 
				source: funders
	 	}); 
	 }); 
	 
	 function author_email_change(data)
 	 {
 	 	  $("#author_faculty_"+currentCount).empty();
      	  if (data.affiliation.length > 1)
      	  {
      	       for(i=0; i<=data.affiliation.length; i++)
			   {	
	      	 	 $("<option/>")
				       .attr("value", data.affiliation[i])
				       .text( data.affiliation[i])
				       .appendTo("#author_faculty_"+currentCount); 
			   }
			  $("#author_faculty_"+currentCount).trigger("change");
		   }
	}
	
	function contact_email_change(data)
 	 {
 	 	  $("#contact_faculty").empty();
      	  if (data.affiliation.length > 1)
      	  {
      	       for(i=0; i<=data.affiliation.length; i++)
			   {	
	      	 	 $("<option/>")
				       .attr("value", data.affiliation[i])
				       .text( data.affiliation[i])
				       .appendTo("#contact_faculty"); 
			   }
			  $("#contact_faculty").trigger("change");
		   }
	}
	
						
	 //$("input[id^='author_lastname']").autocomplete({
	    jQuery("div :input[id^='author_lastname']").live("focus.autocomplete", null, function () {
	        var thisEl = jQuery(this);
	        thisEl.autocomplete({ 
				source: function( request, response ) 
						{ 
						     var data_dict = {}
						     var lastname = request.term 
						     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
						     currentId = thisEl.attr("id");
						     currentCount = currentId.substr(currentId.length - 1);
						     if($("#author_mof_" + currentCount).is(':checked'))
	                        {
							     var firstname = $("#author_firstname_"+currentCount).val() 
							     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
							     var middlename = $("#author_middlename_"+currentCount).val() 
							     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
				                 data_dict['email'] = $("#author_email_"+currentCount).val() 
							     if(request.term.length >= 1)
							  	 {
								  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      {  if (data.firstname.length == 1 && $("#author_firstname_"+currentCount).val() == "")
										      		$("#author_firstname_"+currentCount).val(data.firstname[0])
		 										 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#author_middlename_"+currentCount).val() == "")
										      		$("#author_middlename_"+currentCount).val(data.middlename[0])
										      	 if (data.lastname.length == 1 && data.email.length == 1 && $("#author_email_"+currentCount).val() == "")
										      		{ $("#author_email_"+currentCount).val(data.email[0]);
										      		  author_email_change(data);
										      		}
										      	 if (lastname.toLowerCase()!= (data.lastname[0]).toLowerCase())
										         	response(data.lastname);
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
									  });
								 }
						    }
					   },
				select: function(event,ui) 
					{  		
						 	 emailString = ui.item.value;
						 	 var data_dict = {};
						     var lastname = emailString;
						     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
						     currentId = thisEl.attr("id");
						     currentCount = currentId.substr(currentId.length - 1);
						     var firstname = $("#author_firstname_"+currentCount).val() 
						     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
						     var middlename = $("#author_middlename_"+currentCount).val() 
						     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
			                 data_dict['email'] = $("#author_email_"+currentCount).val() 
						     if(emailString.length >= 1)
						  	 {
							  	  $.ajax({
								      url: "/contribute/people/",
								      type: "POST",
								      data:  data_dict ,
								      contentType: "application/json",
					                  dataType: "json",
								      success: function(data)
									      {  if (data.firstname.length == 1 && $("#author_firstname_"+currentCount).val() == "")
									      		$("#author_firstname_"+currentCount).val(data.firstname[0])
	 										 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#author_middlename_"+currentCount).val() == "")
									      		$("#author_middlename_"+currentCount).val(data.middlename[0])
									      	 if (data.lastname.length == 1 && data.email.length == 1 && $("#author_email_"+currentCount).val() == "")
									      		{ $("#author_email_"+currentCount).val(data.email[0]);
									      		  author_email_change(data);
									      		}
									         //response( data.lastname);
									      },
								      error: function(jqXHR, textStatus, errorThrown)
								          {
				  							alert(textStatus + errorThrown);
									   	  }  
								  });
							 }
					    }
	 	}); 
	   
	 }); 
	 
	 $("#contact_lastname").autocomplete({	    
				source: function( request, response ) 
						{	
						   if($("#contact_mof").is(':checked'))
	                       {
	                         var data_dict = {};
						     var lastname =  request.term ;
						     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
						     var firstname = $("#contact_firstname").val() 
						     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
						     var middlename = $("#contact_middlename").val() 
						     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
			                 data_dict['email'] = $("#contact_email").val() 
						     if(request.term.length >= 1)
						  	 {
							  	  $.ajax({
								      url: "/contribute/people/",
								      type: "POST",
								      data:  data_dict ,
								      contentType: "application/json",
					                  dataType: "json",
								      success: function(data)
									      {  if (data.firstname.length == 1 && $("#contact_firstname").val() == "")
									      		$("#contact_firstname").val(data.firstname[0])
	 										 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#contact_middlename").val() == "")
									      		$("#contact_middlename").val(data.middlename[0])
									      	 if (data.lastname.length == 1 && data.email.length == 1 && $("#contact_email").val() == "")
									      		{ $("#contact_email").val(data.email[0])
									      		  contact_email_change(data);
									      		}
									      	 if (lastname.toLowerCase()!= (data.lastname[0]).toLowerCase())
									         	response( data.lastname);
									      },
								      error: function(jqXHR, textStatus, errorThrown)
								          {
				  							alert(textStatus + errorThrown);
									   	  }  
								  });
							 }
					  	  }
					    },
				select: function(event,ui) 
					{  		 var data_dict = {};
						 	 emailString = ui.item.value;
						 	 var lastname =  emailString
						     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
						     var firstname = $("#contact_firstname").val() 
						     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
						     var middlename = $("#contact_middlename").val() 
						     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
			                 data_dict['email'] = $("#contact_email").val() 
						     if(emailString.length >= 1)
						  	 {
							  	  $.ajax({
								      url: "/contribute/people/",
								      type: "POST",
								      data:  data_dict ,
								      contentType: "application/json",
					                  dataType: "json",
								      success: function(data)
									      {  if (data.firstname.length == 1 && $("#contact_firstname").val() == "")
									      		$("#contact_firstname").val(data.firstname[0])
	 										 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#contact_middlename").val() == "")
									      		$("#contact_middlename").val(data.middlename[0])
									      	 if (data.lastname.length == 1 && data.email.length == 1 && $("#contact_email").val() == "")
									      		{ $("#contact_email").val(data.email[0])
									      		  contact_email_change(data);
									      		}
									         //response( data.lastname);
									      },
								      error: function(jqXHR, textStatus, errorThrown)
								          {
				  							alert(textStatus + errorThrown);
									   	  }  
								  });
							 }
					    }
	 });
	  
	 //$("#author_firstname_1").autocomplete({
	 jQuery("div :input[id^='author_firstname']").live("focus.autocomplete", null, function () {
	        var thisEl = jQuery(this);
	        thisEl.autocomplete({ 
			source: function( request, response ) 
					{	 var data_dict = {}
                         currentId = thisEl.attr("id");
                         currentCount = currentId.substr(currentId.length - 1);
                         if($("#author_mof_" + currentCount).is(':checked'))
	                     {
						     var lastname = $("#author_lastname_"+currentCount).val()
						     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
						     var firstname =  request.term 
						     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
						     var middlename = $("#author_middlename_"+currentCount).val() 
						     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
			                 data_dict['email'] = $("#author_email_"+currentCount).val() 
						     if(request.term.length >= 2)
						  	 {
							  	  $.ajax({
							      url: "/contribute/people/",
							      type: "POST",
							      data:  data_dict ,
							      contentType: "application/json",
				                  dataType: "json",
							      success: function(data)
								      { 
								      	 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#author_middlename_"+currentCount).val() == "")
								      		$("#author_middlename_"+currentCount).val(data.middlename[0])
								      	 if (data.email.length == 1 && $("#author_email_"+currentCount).val() == "")
								      		 { $("#author_email_"+currentCount).val(data.email[0])							      		
										       author_email_change(data);
										     }
								      	 if (data.lastname.length == 1 && $("#author_lastname_"+currentCount).val() == "")
								      		$("#author_lastname_"+currentCount).val(data.lastname[0])
								      	 if (firstname.toLowerCase()!= (data.firstname[0]).toLowerCase())
								         	response( data.firstname);
								      },
							      error: function(jqXHR, textStatus, errorThrown)
							          {
								alert(textStatus + errorThrown);
								   	  }  
								  });
							 }
					    }
				    },
				    select: function(event,ui) 
					{  	
						 emailString = ui.item.value;
						 var data_dict = {}
                         currentId = thisEl.attr("id");
                         currentCount = currentId.substr(currentId.length - 1);
					     var lastname = $("#author_lastname_"+currentCount).val()
					     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
					     var firstname =  emailString;
					     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
					     var middlename = $("#author_middlename_"+currentCount).val() 
					     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
		                 data_dict['email'] = $("#author_email_"+currentCount).val() 
					     if(emailString.length >= 2)
					  	 {
						  	  $.ajax({
						      url: "/contribute/people/",
						      type: "POST",
						      data:  data_dict ,
						      contentType: "application/json",
			                  dataType: "json",
						      success: function(data)
							      { 			      	 
							      	 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#author_middlename_"+currentCount).val() == "")
							      		$("#author_middlename_"+currentCount).val(data.middlename[0])
							      	 if (data.email.length == 1 && $("#author_email_"+currentCount).val() == "")
							      		{ $("#author_email_"+currentCount).val(data.email[0])							      		
									       author_email_change(data);
									     }
							      	 if (data.lastname.length == 1 && $("#author_lastname_"+currentCount).val() == "")
							      		$("#author_lastname_"+currentCount).val(data.lastname[0])
							         //response( data.firstname);
							      },
						      error: function(jqXHR, textStatus, errorThrown)
						          {
							alert(textStatus + errorThrown);
							   	  }  
							  });
						 }	
						 
				    }		 
	 		}); 
	 }); 
	 
	 
	 $("#contact_firstname").autocomplete({
			source: function( request, response ) 
					{	
					  var data_dict = {};	
					  var lastname = $("#contact_lastname").val();			
					  if($("#contact_mof").is(':checked'))
	                  {
    				     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
					     var firstname =  request.term ;
					     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
					     var middlename = $("#contact_middlename").val();
					     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
		                 data_dict['email'] = $("#contact_email").val();
					     if(request.term.length >= 2)
					  	 {
						  	  $.ajax({
						      url: "/contribute/people/",
						      type: "POST",
						      data:  data_dict ,
						      contentType: "application/json",
			                  dataType: "json",
						      success: function(data)
							      { 
		 							 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#contact_middlename").val() == "")
							      		$("#contact_middlename").val(data.middlename[0]);
							      	 if (data.email.length == 1 && $("#contact_email").val() == "")
							      		{ $("#contact_email").val(data.email[0]);
							      		  contact_email_change(data);
									     }
							      	 if (data.lastname.length == 1 && $("#contact_lastname").val() == "")
							      		$("#contact_lastname").val(data.lastname[0]);
							      	 if (firstname.toLowerCase()!= (data.firstname[0]).toLowerCase())
							         	response( data.firstname);
							      },
						      error: function(jqXHR, textStatus, errorThrown)
						          {
									alert(textStatus + errorThrown);
							   	  }  
							  });
						  }
				       }
                    },
		    select: function(event,ui) 
					{   	
						 emailString = ui.item.value;
						 var data_dict = {}
					     var lastname = $("#contact_lastname").val()
					     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
					     var firstname =  emailString 
					     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
					     var middlename = $("#contact_middlename").val() 
					     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
		                 data_dict['email'] = $("#contact_email").val() 
					     if(emailString.length >= 2)
					  	 {
						  	  $.ajax({
						      url: "/contribute/people/",
						      type: "POST",
						      data:  data_dict ,
						      contentType: "application/json",
			                  dataType: "json",
						      success: function(data)
							      { 
		 							 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#contact_middlename").val() == "")
							      		$("#contact_middlename").val(data.middlename[0])
							      	 if (data.email.length == 1 && $("#contact_email").val() == "")
							      		{ $("#contact_email").val(data.email[0])
							      		  contact_email_change(data);
									    }
							      	 if (data.lastname.length == 1 && $("#contact_lastname").val() == "")
							      		$("#contact_lastname").val(data.lastname[0])
							         //response( data.firstname);
							      },
						      error: function(jqXHR, textStatus, errorThrown)
						          {
							alert(textStatus + errorThrown);
							   	  }  
							  });
						 }
				    }
	 }); 
	 
	  //$("#author_middlename_1").autocomplete({
	  jQuery("div :input[id^='author_middlename']").live("focus.autocomplete", null, function () {
	        var thisEl = jQuery(this);
	        thisEl.autocomplete({ 
								source: function( request, response ) 
								{	 var data_dict = {}
					                 currentId = thisEl.attr("id");
					                 currentCount = currentId.substr(currentId.length - 1);	
					                 if($("#author_mof_" + currentCount).is(':checked'))
	                                 {		
									     lastname = $("#author_lastname_"+currentCount).val()
									     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
									     firstname = $("#author_firstname_"+currentCount).val() 
									     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
									     middlename=request.term 
									     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
						                 data_dict['email'] = $("#author_email_"+currentCount).val() 
									     if(request.term.length >= 2)
									  	 {
										  	  $.ajax({
										      url: "/contribute/people/",
										      type: "POST",
										      data:  data_dict ,
										      contentType: "application/json",
							                  dataType: "json",
										      success: function(data)
											      {  if (data.firstname.length == 1 && $("#author_firstname_"+currentCount).val() == "")
											      		$("#author_firstname_"+currentCount).val(data.firstname[0])
											      	 if (data.email.length == 1 && $("#author_email_"+currentCount).val() == "")
											      		{ $("#author_email_"+currentCount).val(data.email[0])
											      		  author_email_change(data);
										                }
											      	 if (data.lastname.length == 1 && $("#author_lastname_"+currentCount).val() == "")
											      		$("#author_lastname_"+currentCount).val(data.lastname[0])
											      	 if (middlename.toLowerCase()!= (data.middlename[0]).toLowerCase())
											         	response( data.middlename);
											      },
										      error: function(jqXHR, textStatus, errorThrown)
										          {
						  							alert(textStatus + errorThrown);
											   	  }  
											  });
										 }
			    					}
		    					},
		    					select: function(event,ui) 
								{   	
						 			 emailString = ui.item.value;	
						 			 var data_dict = {}
					                 currentId = thisEl.attr("id");
					                 currentCount = currentId.substr(currentId.length - 1);			
								     lastname = $("#author_lastname_"+currentCount).val()
								     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
								     firstname = $("#author_firstname_"+currentCount).val() 
								     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
								     middlename=emailString
								     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
					                 data_dict['email'] = $("#author_email_"+currentCount).val() 
								     if(emailString.length >= 2)
								  	 {
									  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      {  if (data.firstname.length == 1 && $("#author_firstname_"+currentCount).val() == "")
										      		$("#author_firstname_"+currentCount).val(data.firstname[0])
										      	 if (data.email.length == 1 && $("#author_email_"+currentCount).val() == "")
										      		{ $("#author_email_"+currentCount).val(data.email[0])
										      		  author_email_change(data);
									                }
										      	 if (data.lastname.length == 1 && $("#author_lastname_"+currentCount).val() == "")
										      		$("#author_lastname_"+currentCount).val(data.lastname[0])
										         //response( data.middlename);
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
										  });
									 }
								}
	 					}); 
	});
	
	
		 
	 $("#contact_middlename").autocomplete({
								source: function( request, response ) 
								{																	
								   if($("#contact_mof").is(':checked'))
			                       {
								     var data_dict = {}
								     lastname = $("#contact_lastname").val()
								     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
								     firstname = $("#contact_firstname").val() 
								     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
								     middlename = request.term 
								     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
					                 data_dict['email'] = $("#contact_email").val() 
								     if(request.term.length >= 2)
								  	 {
									  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      {  if (data.firstname.length == 1  && $("#contact_firstname").val() == "")
										      		$("#contact_firstname").val(data.firstname[0])
										      	 if (data.email.length == 1 && $("#contact_email").val() == "")
										      		{ $("#contact_email").val(data.email[0])
										      	      contact_email_change(data);
									                }
										      	 if (data.lastname.length == 1 && $("#contact_lastname").val() == "")
										      		$("#contact_lastname").val(data.lastname[0])
										      	 if (middlename.toLowerCase()!= (data.middlename[0]).toLowerCase())										      		
										         	response( data.middlename);
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
										  });
									}
								  }
		    					},
		    					select: function(event,ui) 
								{   	
						 			 emailString = ui.item.value;		
						 			 var data_dict = {}
								     lastname = $("#contact_lastname").val()
								     data_dict['lastname'] = lastname.charAt(0).toUpperCase() + lastname.slice(1);
								     firstname = $("#contact_firstname").val() 
								     data_dict['firstname'] = firstname.charAt(0).toUpperCase() + firstname.slice(1);
								     middlename = emailString
								     data_dict['middlename'] = middlename.charAt(0).toUpperCase() + middlename.slice(1);
					                 data_dict['email'] = $("#contact_email").val() 
								     if(emailString.length >= 2)
								  	 {
									  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      {  if (data.firstname.length == 1  && $("#contact_firstname").val() == "")
										      		$("#contact_firstname").val(data.firstname[0])
										      	 if (data.email.length == 1 && $("#contact_email").val() == "")
										      		{ $("#contact_email").val(data.email[0])
										      	      contact_email_change(data);
									                }
										      	 if (data.lastname.length == 1 && $("#contact_lastname").val() == "")
										      		$("#contact_lastname").val(data.lastname[0])
										         //response( data.middlename);
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
										  });
									}
		    					}	 						  
	});
 
	
	 function email_function(thisEl) {
	        data_dict = {};
			currentId = thisEl.attr("id");
            currentCount = currentId.substr(currentId.length - 1);
		    data_dict['lastname'] = $("#author_lastname_"+currentCount).val();
		    data_dict['firstname'] = $("#author_firstname_"+currentCount).val() ;
		    data_dict['middlename'] = $("#author_middlename_"+currentCount).val() ;
	        thisEl.autocomplete({         							
								source: function( request, response ) 
								{	
								     if($("#author_mof_" + currentCount).is(':checked'))
	                                 {					                 																			    
						                 data_dict['email'] = request.term 
									     if(request.term.length >= 2)
									  	 {
										  	  $.ajax({
										      url: "/contribute/people/",
										      type: "POST",
										      data:  data_dict ,
										      contentType: "application/json",
							                  dataType: "json",
										      success: function(data)
											      { 
											         if (data.firstname.length == 1 && $("#author_firstname_"+currentCount).val() == "")
											      		$("#author_firstname_"+currentCount).val(data.firstname[0])
											      	 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#author_middlename_"+currentCount).val() == "")
											      		$("#author_middlename_"+currentCount).val(data.middlename[0])
											      	 if (data.lastname.length == 1  && $("#author_lastname_"+currentCount).val() == "")
											      		$("#author_lastname_"+currentCount).val(data.lastname[0])
													 if ((request.term).toLowerCase()!= (data.email[0]).toLowerCase())
													    { author_email_change(data);										      		
														  response( data.email);
														}
											      },
										      error: function(jqXHR, textStatus, errorThrown)
										          {
						  							alert(textStatus + errorThrown);
											   	  }  
											  });
										 }
								    }
							    },
							    select: function(event,ui) 
		    					{  	
		    						 emailString = ui.item.value
					                 data_dict['email'] =  emailString; 
								     if(emailString.length >= 2)
								  	 {
									  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      { 
										          if (data.firstname.length == 1 && $("#author_firstname_"+currentCount).val() == "")
										      		$("#author_firstname_"+currentCount).val(data.firstname[0])
										      	 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#author_middlename_"+currentCount).val() == "")
										      		$("#author_middlename_"+currentCount).val(data.middlename[0])
										      	 if (data.lastname.length == 1  && $("#author_lastname_"+currentCount).val() == "")
										      		$("#author_lastname_"+currentCount).val(data.lastname[0])
										      		author_email_change(data);											      		
										         // response( data.email);
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
										  });
									 }
							    }							   
	 						});  	

	 }
 
	 jQuery("div :input[id^='author_email']").live("focus.autocomplete", null, function(){
	      var thisEl = jQuery(this);
	   	  email_function(thisEl);

     });

 	 $("#contact_email").autocomplete({	  
								source: function( request, response ) 
								{	 														
							     if($("#contact_mof").is(':checked'))
		                         {
								     var data_dict = {}								
								     data_dict['lastname'] = $("#contact_lastname").val()
								     data_dict['firstname'] = $("#contact_firstname").val() 
								     data_dict['middlename'] = $("#contact_middlename").val() 
					                 data_dict['email'] = request.term 
								     if(request.term.length >= 2)
								  	 {
									  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      { 
										         if (data.firstname.length == 1 && $("#contact_firstname").val() == "")
										      		$("#contact_firstname").val(data.firstname[0])
										      	 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#contact_middlename").val() == "")
										      		$("#contact_middlename").val(data.middlename[0])
										      	 if (data.lastname.length == 1  && $("#contact_lastname").val() == "")
										      		$("#contact_lastname").val(data.lastname[0])
												 if ((request.term).toLowerCase()!= (data.email[0]).toLowerCase())		
										         	{ contact_email_change(data);	
										         	  response( data.email);
										         	}
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
										  });
									 }
								  }
							    }, 	
							    select: function(event,ui) 
		    					{  	
		    						 emailString = ui.item.value
								  	 var data_dict = {}								
								     data_dict['lastname'] = $("#contact_lastname").val()
								     data_dict['firstname'] = $("#contact_firstname").val() 
								     data_dict['middlename'] = $("#contact_middlename").val() 
								     data_dict['email'] =  emailString;
								     if(emailString.length >= 2)
								  	 {
									  	  $.ajax({
									      url: "/contribute/people/",
									      type: "POST",
									      data:  data_dict ,
									      contentType: "application/json",
						                  dataType: "json",
									      success: function(data)
										      { 
										         if (data.firstname.length == 1 && $("#contact_firstname").val() == "")
										      		$("#contact_firstname").val(data.firstname[0])
										      	 if (data.lastname.length == 1 && data.middlename.length == 1 && $("#contact_middlename").val() == "")
										      		$("#contact_middlename").val(data.middlename[0])
										      	 if (data.lastname.length == 1  && $("#contact_lastname").val() == "")
										      		$("#contact_lastname").val(data.lastname[0])	
										      	 contact_email_change(data);										      
										        // response( data.email);
										      },
									      error: function(jqXHR, textStatus, errorThrown)
									          {
					  							alert(textStatus + errorThrown);
										   	  }  
										  });
									 }
								},								
	 });
	 
	  
     $('#is_role').change(function() 
     {
	    if($(this).is(':checked') == true) 
	    {   
	       $('#name_details').css("display", "none");
	       $('#contact').css("display", "none");
	    } 
     });
     
     $('#contact_mof').change(function() 
     {
	    if($(this).is(':checked') == true) 
		  {								      
	       $('#contact_faculty_text_div').css("display", "none");
	       $('#contact_faculty_select_div').css("display", "block");	
	       $('#oxford_college').css("display", "block");	       
	      }
	    else
	      {
	       $('#contact_faculty_text_div').css("display", "block");
	       $('#contact_faculty_select_div').css("display", "none");
	       $('#oxford_college').css("display", "none");	
	      }
	      
     });
     
   
        
    // jQuery("div :input[id^='author_mof']").live("change", null, function (){
    $("div :input[id^='author_mof']").live("change", null, function ()
    // $('div').on('change','input[id^="author_mof"]', function() 
    {   var thisEl = jQuery(this);
        currentId = thisEl.attr("id");
        currentCount = currentId.substr(currentId.length - 1);
        
	    if($(this).is(':checked') == true) 
		  {								      
	       $('#author_faculty_text_div_' + currentCount).css("display", "none");
	       $('#author_faculty_select_div_' + currentCount).css("display", "block");	
	       $('#author_oxford_college_' + currentCount).css("display", "block");	       
	      }
	    else
	      {
	       $('#author_faculty_text_div_' + currentCount).css("display", "block");
	       $('#author_faculty_select_div_' + currentCount).css("display", "none");
	       $('#author_oxford_college_' + currentCount).css("display", "none");	
	      }	   

     })
     
     
     $('#is_person').change(function() 
     {
	    if($(this).is(':checked') == true) 
	    {   
	       $('#name_details').css("display", "block");
	       $('#contact').css("display", "block");
	    } 
     });
	 
	 
	 
     $('#single_date').change(function() 
     {
	    if($(this).val()=='single_date')
	     {   
	       $('#single_temporal_date_block').css("display", "block");
	       $('#date_range_temporal_block').css("display", "none");
	    } 
     });
  
     $('#date_range').change(function() 
     {
	    if($(this).val()=='date_range') 
	    {   
	       $('#single_temporal_date_block').css("display", "none");
	       $('#date_range_temporal_block').css("display", "block");
	    } 
     });
     
     $('#data_collected_single_date').change(function() 
     {
	    if($(this).val()=='data_collected_single_date')
	     {   
	       $('#data_collected_single_temporal_date_block').css("display", "block");
	       $('#data_collected_date_range_temporal_block').css("display", "none");
	    } 
     });
  
     $('#data_collected_date_range').change(function() 
     {
	    if($(this).val()=='data_collected_date_range') 
	    {   
	       $('#data_collected_single_temporal_date_block').css("display", "none");
	       $('#data_collected_date_range_temporal_block').css("display", "block");
	    } 
     });
  
    $('#depositDataYes').change(function() 
    {
	    if($(this).val()=='yes') {   
	       $('#depositfileupload').removeAttr('disabled');

	    } else {
	       $('#depositfileupload').attr('disabled', 'disabled');
    } 
  });
    $('#depositDataNo').change(function() 
    {
	    if($(this).val()=='yes') {   
	       $('#depositfileupload').removeAttr('disabled');

	    } else {
	       $('#depositfileupload').attr('disabled', 'disabled');
    } 
  });
  
  
  $('#fundedResearch').click(function() 
    { 
	    if($(this).is(':checked')) {   	    
	             $('#fundedAgency').removeAttr('disabled');
	             $('#grantNumber').removeAttr('disabled');
	             $('#projectDesc').removeAttr('disabled');\
	             
	    } else {
	             $('#fundedAgency').attr('disabled', 'disabled');   
	    	     $('#grantNumber').attr('disabled', 'disabled');
	    	     $('#projectDesc').attr('disabled', 'disabled');
    } 
  });
  
  $('#register').click( function()
	{
	    var actionURL = "/admin/register_source/";
	    $('#form1').attr('action', actionURL);  
	    $("#form1")[0].submit();    
	});
  $('#activate').click( function()
	{
	    var actionURL =  "/admin/activate_source/";
	    $('#form1').attr('action', actionURL);
        $("#form1")[0].submit();    
	});

  $('a.delete').click( function() {
    var theAnchor = this;
    var redirectURL = $(this).attr('data-url');
    if ( confirm('Are you sure you want to delete this?' ) )
      $.ajax({
        type: 'DELETE',
        url: $(this).attr('href'),
        dataType: 'json',
        success: function() {
           
            var toRemove = $(theAnchor).attr('data-remove');
            $("#" + toRemove).remove();
            window.location.replace(redirectURL);
           
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) 
        {
          alert("Ooooops!, request failed with status: " + XMLHttpRequest.status + ' ' + XMLHttpRequest.responseText);
        }
      });
    return false;
  });
  
  $('#adduser').click( function()
	{   var user_sso_id =   $('#user_sso_id').val()
	    var actionURL = "/admin/users/add/?user_sso_id=" + user_sso_id;
	    $('#manageusers').attr('action', actionURL);  
	    $("#manageusers")[0].submit();    
	});
  $('#edituser').click( function()
	{   var user_sso_id =   $('#user_sso_id').val()
	    var actionURL = "/admin/users/edit/?user_sso_id=" + user_sso_id;
	    $('#manageusers').attr('action', actionURL);  
	    $("#manageusers")[0].submit();    
	});
	
  $('#deluser').click( function()
	{
	    var actionURL = "/admin/users/del/?user_sso_id=" + user_sso_id;
	    $('#manageusers').attr('action', actionURL);  
	    $("#manageusers")[0].submit();    
	});
	;
   
  $("#deposit_data_yes").change(function() 
    {
     if($(this).is(':checked') == true){
    		 window.open("https://databank.ora.ox.ac.uk/", '_blank');
    		 }
    });
   
  $("#data_format_yes").change(function() 
    {   
	     if($(this).is(':checked') == true)
	     {
	    		
	    		$("#digital_location_label").css("display", "block");
	    		$("#non_digital_location_label").css("display", "none");
	    		
	    		$("#digital_object_identifier").parent().css("display", "block");
				$("#digital_resource_type").parent().css("display", "block");
				$("#digital_filesize").parent().css("display", "block");
				$("#digital_format").parent().css("display", "block");
				$("#digital_version").parent().css("display", "block");
	     }
	});
	
	
 $("#data_format_no").change(function() 
    {	
	     if( $(this).is(':checked') == true)
	     {
	        	$("#digital_location_label").css("display", "none");
	    		$("#non_digital_location_label").css("display", "block");
	    		
	    		$("#digital_object_identifier").parent().css("display", "none");
	    		$("#digital_resource_type").parent().css("display", "none");
				$("#digital_filesize").parent().css("display", "none");
				$("#digital_format").parent().css("display", "none");
				$("#digital_version").parent().css("display", "none");
	     }
	});
	
    
   
  $("#funded_research_yes").change(function() 
    {   
	     if($(this).is(':checked') == true)
	     {
	    		$("#fund_and_grant").css("display", "block");
	     }
	});
	
  $("#funded_research_no").change(function() 
    {   
	     if($(this).is(':checked') == true)
	     {
	    		$("#fund_and_grant").css("display", "none");
	     }
	});
	
  $("#title_more_info").click(function() 
    {   
         right_arrow = '${ STATIC_URL }/right_circled_arrow.png'
         down_arrow = '${ STATIC_URL }/down_circled_arrow.png'
         
         if ($(this).attr('src') == right_arrow )
         {
	    		$(this).attr('src', down_arrow);
	    		$("#alt_title").css("display", "block");
	     }
	     else
	     {
	     		$(this).attr('src', right_arrow);
	     		$("#alt_title").css("display", "none");
	     }
	    return false;
	});
	


  $("#project_more_info").click(function() 
    {   
         right_arrow = '${ STATIC_URL }/right_circled_arrow.png'
         down_arrow = '${ STATIC_URL }/down_circled_arrow.png'
         
         if ($(this).attr('src') == right_arrow )
         {
	    		$(this).attr('src', down_arrow);
	    		$("#proj_info").css("display", "block");
	     }
	     else
	     {
	     		$(this).attr('src', right_arrow);
	     		$("#proj_info").css("display", "none");
	     }
	    return false;
	});
	
	$("#subject_more_info").click(function() 
    {   
         right_arrow = '${ STATIC_URL }/right_circled_arrow.png'
         down_arrow = '${ STATIC_URL }/down_circled_arrow.png'
         
         if ($(this).attr('src') == right_arrow )
         {
	    		$(this).attr('src', down_arrow);
	    		$("#subj_info").css("display", "block");
	     }
	     else
	     {
	     		$(this).attr('src', right_arrow);
	     		$("#subj_info").css("display", "none");
	     }
	    return false;
	});
	
	$("#data_more_info").click(function() 
    {   
         right_arrow = '${ STATIC_URL }/right_circled_arrow.png'
         down_arrow = '${ STATIC_URL }/down_circled_arrow.png'
         
         if ($(this).attr('src') == right_arrow )
         {
	    		$(this).attr('src', down_arrow);
	    		$("#more_about_data").css("display", "block");
	     }
	     else
	     {
	     		$(this).attr('src', right_arrow);
	     		$("#more_about_data").css("display", "none");
	     }
	    return false;
	});

	$("#related_more_info").click(function() 
    {   
         right_arrow = '${ STATIC_URL }/right_circled_arrow.png'
         down_arrow = '${ STATIC_URL }/down_circled_arrow.png'
         
         if ($(this).attr('src') == right_arrow )
         {
	    		$(this).attr('src', down_arrow);
	    		$("#related_info").css("display", "block");
	     }
	     else
	     {
	     		$(this).attr('src', right_arrow);
	     		$("#related_info").css("display", "none");
	     }
	    return false;
	});
	

	
	$('div').on('click','img[id^="subject_add_more"]', function() 
    {   
         plus = '${ STATIC_URL }/gplus.png'
         minus = '${ STATIC_URL }/gminus.png'
         
         if ($(this).attr('src') == plus )
         { 		
			    var currentCount =  $('.subject_area_repeatable').length ; 
			    var newCount = currentCount+1;
			    var lastRepeatingGroup = $('.subject_area_repeatable').last();
			    var newSection = lastRepeatingGroup.clone();
			    newSection.insertAfter(lastRepeatingGroup);
			    newSection.find("input").each(function (index, input) {
			        input.id = input.id.replace("_" + currentCount, "_" + newCount);
			        var i = $(input);
			        i.val("");
			    });
			    newSection.find("img").each(function (index, img) {
			        img.id = img.id.replace("_" + currentCount, "_" + newCount);
			        img.src = img.src.replace("gplus", "gminus");
			    });
			    newSection.find("label").each(function (index, label) {			    
			         var l = $(label);
			         l.text("");
			        // l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
			    }); 
	    	
	     }
	     else
	     {
	     		$(this).parent('div').remove();
   		 		return false; 
	     		
	     }
	    return false;
	});
	
	$('div').on('click','img[id^="keyword_add_more"]', function() 
    {   
         plus = '${ STATIC_URL }/gplus.png'
         minus = '${ STATIC_URL }/gminus.png'
         
         if ($(this).attr('src') == plus )
         { 		
			    var currentCount =  $('.keywords_repeatable').length ; 
			    var newCount = currentCount+1;
			    var lastRepeatingGroup = $('.keywords_repeatable').last();
			    var newSection = lastRepeatingGroup.clone();
			    newSection.insertAfter(lastRepeatingGroup);
			    newSection.find("input").each(function (index, input) {
			        input.id = input.id.replace("_" + currentCount, "_" + newCount);
			        var i = $(input);
			        i.val("");
			    });
			    newSection.find("img").each(function (index, img) {
			        img.id = img.id.replace("_" + currentCount, "_" + newCount);
			        img.src = img.src.replace("gplus", "gminus");
			    });
			    newSection.find("label").each(function (index, label) {			    
			         var l = $(label);
			         l.text("");
			        // l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
			    }); 
	    	
	     }
	     else
	     {
	     		$(this).parent('div').remove();
   		 		return false; 
	     		
	     }
	    return false;
	});
	
	
	$('div').on('click','img[id^="person_add_more"]', function() 
    {   
         plus = '${ STATIC_URL }/gplus.png'
         minus = '${ STATIC_URL }/gminus.png'
         
         if ($(this).attr('src') == plus )
         { 		
			    var currentCount =  $('.person_repeatable').length ; 
			    var newCount = currentCount+1;
			    var lastRepeatingGroup = $('.person_repeatable').last();
			    var newSection = lastRepeatingGroup.clone();
			    newSection.insertAfter(lastRepeatingGroup);
			    newSection.find("input").each(function (index, input) {
			        input.id = input.id.replace("_" + currentCount, "_" + newCount);
			        input.name = input.name.replace("_" + currentCount, "_" + newCount);
			        var i = $(input);
			        i.val("");
			    });
			    newSection.find("select").each(function (index, select) {
			        select.id = select.id.replace("_" + currentCount, "_" + newCount);
			        select.name = select.name.replace("_" + currentCount, "_" + newCount);
			        var i = $(select);			        
			        i.text("");
			        i.html('');
			        //i.empty();
			        i.trigger("change");
			    });
			    newSection.find("img").each(function (index, img) {
			        img.id = img.id.replace("_" + currentCount, "_" + newCount);
			        img.src = img.src.replace("gplus", "gminus");
			    });
			    newSection.find("div").each(function (index, div) {
			        div.id = div.id.replace("_" + currentCount, "_" + newCount);
			       // div.name = div.name.replace("_" + currentCount, "_" + newCount);
			    });
			    newSection.find("label").each(function (index, label) {			    
			         var l = $(label);
			        // l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
			    }); 
	    	
	     }
	     else
	     {
	     		$(this).parent('div').parent('div').remove();
   		 		return false; 
	     		
	     }
	    return false;
	});
	
	$('div').on('click','img[id^="funding_add_more"]', function() 
    {   
         plus = '${ STATIC_URL }/gplus.png'
         minus = '${ STATIC_URL }/gminus.png'
         
         if ($(this).attr('src') == plus )
         { 		
			    var currentCount =  $('.funding_repeatable').length ; 
			    var newCount = currentCount+1;
			    var lastRepeatingGroup = $('.funding_repeatable').last();
			    var newSection = lastRepeatingGroup.clone();
			    newSection.insertAfter(lastRepeatingGroup);
			    newSection.find("input").each(function (index, input) {
			        input.id = input.id.replace("_" + currentCount, "_" + newCount);
			        input.name = input.name.replace("_" + currentCount, "_" + newCount);
			        var i = $(input);
			        i.val("");
			    });
			    newSection.find("img").each(function (index, img) {
			        img.id = img.id.replace("_" + currentCount, "_" + newCount);
			        img.src = img.src.replace("gplus", "gminus");
			    });
			    newSection.find("label").each(function (index, label) {			    
			         var l = $(label);
			         l.text("");
			        // l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
			    }); 
	    	
	     }
	     else
	     {
	     		$(this).parent('div').remove();
   		 		return false; 
	     		
	     }
	    return false;
	});
	
		$('div').on('click','img[id^="publication_add_more"]', function() 
    {   
         plus = '${ STATIC_URL }/gplus.png'
         minus = '${ STATIC_URL }/gminus.png'
         
         if ($(this).attr('src') == plus )
         { 		
			    var currentCount =  $('.publication_repeatable').length ; 
			    var newCount = currentCount+1;
			    var lastRepeatingGroup = $('.publication_repeatable').last();
			    var newSection = lastRepeatingGroup.clone();
			    newSection.insertAfter(lastRepeatingGroup);
			    newSection.find("select").each(function (index, select) {
			        select.id = select.id.replace("_" + currentCount, "_" + newCount);
			        select.name = select.name.replace("_" + currentCount, "_" + newCount);
			    });
			    newSection.find("input").each(function (index, input) {
			        input.id = input.id.replace("_" + currentCount, "_" + newCount);
			        input.name = input.name.replace("_" + currentCount, "_" + newCount);
			        var i = $(input);
			        i.val("");
			    });
			    newSection.find("img").each(function (index, img) {
			        img.id = img.id.replace("_" + currentCount, "_" + newCount);
			        img.src = img.src.replace("gplus", "gminus");
			    });
			    newSection.find("label").each(function (index, label) {			    
			         var l = $(label);
			        l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
			    }); 
	    	
	     }
	     else
	     {
	     		$(this).parent('div').remove();
   		 		return false; 
	     		
	     }
	    return false;
	});

	$('#prepared_licence').on('change', function(){
	    if( $('#prepared_licence').is(':checked')) 
	    {
	      $('#data_standard_licence_URL_block').css("display", "block");
	      $('#data_standard_licence_select_block').css("display", "none");
	      $('#data_standard_licence_text_block').css("display", "none");
	      $('#data_standard_licence_URI').val("");  
	      
		  % if solr_response:
		  		% for df_record in solr_response['docs']:
		  			% if 'license' in df_record:    			   
								 $('#data_standard_licence_URI').val("${df_record['license'][0]}"); 
						% endif			            			
		  		% endfor
		  % endif
	      	
	    }
    });
    
    $('#bespoke_licence').on('change', function(){
	    if( $('#bespoke_licence').is(':checked')) 
	    {
	      $('#data_standard_licence_select_block').css("display", "none");
	      $('#data_standard_licence_URL_block').css("display", "none");
	      $('#data_standard_licence_text_block').css("display", "block");	
	    }   
	    
	     % if solr_response:
		  		% for df_record in solr_response['docs']:
		  			% if 'license' in df_record:    			   
								 $('#data_standard_licence_text').val("${df_record['license'][0]}"); 
						% endif			            			
		  		% endfor
		  % endif
    });
    
    $('#other_licence').on('change', function(){
	    if( $('#other_licence').is(':checked')) 
	    {
	      $('#data_standard_licence_select_block').css("display", "none");
	      $('#data_standard_licence_URL_block').css("display", "none");
	      $('#data_standard_licence_text_block').css("display", "block"); 	
	    }
	        
	       % if solr_response:
		  		% for df_record in solr_response['docs']:
		  			% if 'license' in df_record:    			   
								 $('#data_standard_licence_text').val("${df_record['license'][0]}"); 
					% endif			            			
		  		% endfor
		  % endif
	});
	
    $('#data_standard_licence_URI').val( $('#data_standard_licence').val() ); 
    
    $('#select_a_licence').on('change', function(){
	    if( $('#select_a_licence').is(':checked')) 
	    {
	      $('#data_standard_licence_select_block').css("display", "block");
	      $('#data_standard_licence_URL_block').css("display", "block");
	      $('#data_standard_licence_text_block').css("display", "none");
	      $('#data_standard_licence_URI').val( $('#data_standard_licence').val() );  	
	    }
    });
    
	
   <% allowed_select_license_values = [ "http://creativecommons.org/choose/zero/",
	  	"http://opendatacommons.org/licenses/by/",
	  	"http://opendatacommons.org/licenses/odbl/",
	 	"http://opendatacommons.org/licenses/pddl/",
	  	"http://www.nationalarchives.gov.uk/doc/open-government-licence/version/2/",
	  	"http://www.nationalarchives.gov.uk/doc/non-commercial-government-licence/"]
  	%>
    
    % if solr_response:
  		% for df_record in solr_response['docs']:
  			% if 'license' in df_record:
  			    % if df_record['license'][0] in allowed_select_license_values:      			   
	  				     $("#data_standard_licence").val("${df_record['license'][0]}");
						 $('#data_standard_licence_URI').val("${df_record['license'][0]}"); 
				% endif			            			
  			% endif	
  		% endfor
    % endif
   
    % if solr_response:
  		% for df_record in solr_response['docs']:
  			% if 'license_radio' in df_record:
   	 			$("#${df_record['license_radio']}").prop('checked', true);
   	 			$("#${df_record['license_radio']}").trigger("change");
			% endif			            			
  		% endfor
    % endif
    
	$('#data_standard_licence').change(function()  {
	   $('#data_standard_licence_URI').val( this.value );  		  
	});
		  
		$('div').on('click','img[id^="dataset_add_more"]', function() 
   		{   
         plus = '${ STATIC_URL }/gplus.png'
         minus = '${ STATIC_URL }/gminus.png'
         
         if ($(this).attr('src') == plus )
         { 		
			    var currentCount =  $('.dataset_repeatable').length ; 
			    var newCount = currentCount+1;
			    var lastRepeatingGroup = $('.dataset_repeatable').last();
			    var newSection = lastRepeatingGroup.clone();
			    newSection.insertAfter(lastRepeatingGroup);
			    newSection.find("select").each(function (index, select) {
			        select.id = select.id.replace("_" + currentCount, "_" + newCount);
			        select.name = select.name.replace("_" + currentCount, "_" + newCount);
			    });
			    newSection.find("input").each(function (index, input) {
			        input.id = input.id.replace("_" + currentCount, "_" + newCount);
			        input.name = input.name.replace("_" + currentCount, "_" + newCount);
			        var i = $(input);
			        i.val("");
			    });
			    newSection.find("img").each(function (index, img) {
			        img.id = img.id.replace("_" + currentCount, "_" + newCount);
			        img.src = img.src.replace("gplus", "gminus");
			    });
			    newSection.find("label").each(function (index, label) {			    
			         var l = $(label);
			        l.attr('for', l.attr('for').replace("_" + currentCount, "_" + newCount));
			    }); 
	    	
	     }
	     else
	     {
	     		$(this).parent('div').remove();
   		 		return false; 
	     		
	     }
	    return false;
	});
});
	//search 

	function fhAdjust(){
		//Make sure facets do not stick beneath footer
		navh = document.getElementById('facet_wrapper').style.height;
		navh = navh + 211;
		wrah = document.getElementById('results-controls').style.height;
		if (navh > wrah)
		 {
			document.getElementById('results-controls').style.height =  navh + 100;
		}
		 else 
		{
			mainh = document.getElementById('mainContent').height;
			mainh = mainh + 91;
			if (mainh > navh){
				document.getElementById('results-controls').style.height = mainh + 100;
			} else {
				document.getElementById('results-controls').style.height =  navh + 100;
			}
		}
	}
	
	function bindItem(ind){  
		    //$('#fh' + ind).click(function(event) {
		    //$("[id^=fh]").click(function(event) {
		    //$('#fh1').click(function(event) {
			//event.preventDefault();
			//alert("i am here");
			//if ((document.getElementById('fl' + ind)).classList.contains("closed"))
			if((document.getElementById('fl' + ind)).className.match("closed"))
			{
				document.getElementById('fl' + ind).style.display = "block";
				//document.getElementById('fl' + ind).className.replace("closed"," ");
				document.getElementById('fl' + ind).className -= "closed";
				//document.getElementById('fl' + ind).className += " " + newClassName;
				//document.getElementById('fh' + ind).style.backgroundImage= "url('/static/styles/images/fminus.png')";
				//document.getElementById('fs' + ind).style.backgroundColor = "#A79D96";
			} 
			else 
			{
				document.getElementById('fl' + ind).style.display= "none";
				//document.getElementById('fl' + ind).classList.add ="closed";
				document.getElementById('fl' + ind).className += " " + "closed";
				//document.getElementById('fh' + ind).style.backgroundImage= "url('/static/styles/images/fplus.png')";
				//document.getElementById('fs' + ind).style.backgroundColor = "#999";
		  	}
			//fhAdjust();
	}
	
	
</script>

  <script src="/static/js/assignFASTPage.js" type="text/javascript"></script>
  <script src="/static/js/assignFASTExample.js" type="text/javascript"></script>
  <script src="/static/js/assignFASTGadget.js" type="text/javascript"></script> 
  <script src="/static/js/assignFASTComplete.js" type="text/javascript"></script>
  
 <!--[if lt IE 9]>

  <script type="text/javascript" src="/static/js/html5.js" />
  <![endif]-->
  
  <!-- auto-discovery link to sword service document -->
  <link rel="http://purl.org/net/sword/discovery/service-document" href="/swordv2/service-document"/>
  
  <!-- print stylesheet for print stlying -->
  <!-- <link media="print"  href="/static/styles/print.css" rel="stylesheet" type="text/css"/>-->
  
  
  <!-- general reset styles for getting rid of annoying browser defaults -->
  <!-- <link media="all"  href="/static/styles/reset.css" rel="stylesheet" type="text/css"/> -->

  <!-- basic styles suitable for all devices *DO NOT put layout stuff here * -->
  <!-- <link media="all"  href="/static/styles/basic.css" rel="stylesheet" type="text/css"/> -->

  <!-- styles for mobile devices-->
  <!-- <link href="/static/styles/marmoset.css" rel="stylesheet" type="text/css" media="screen and (max-width: 639px)"/> -->

  <!-- styles for smallscreen devices-->
  <!-- <link href="/static/styles/squirrelMonkey.css" rel="stylesheet" type="text/css" media="(min-width: 640px)"/> --> 


  <!-- styles for small-to-medium screen desktop  devices-->
  <!-- <link rel="stylesheet" type="text/css" href="/static/styles/chimpanzee.css"
media="(min-width: 1100px) and (max-width: 1600px)"/> -->


  <!-- styles for large screen desktop devices-->
  <!-- <link  rel="stylesheet" type="text/css" href="/static/styles/silverback.css" media="screen and (min-width: 1601px)"/> --> 


  <!-- styles for Internet explorer - imports the small/medium desktop stylesheet and contains  any ie-specific styles -->
  <!--[if (gt IE 4)&(lt IE 9)]>
    <link media="screen" href="/static/styles/ie.css" rel="stylesheet" type="text/css"/>
  <![endif]-->

<!-- encourage mobile devices to initially load the site without zooming out -->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<meta name="keywords" content="" />

<meta name="description" content="" />
 
  </head>
<body>
  <div id="page" >
  <!--
  <ul class="skipLinks">
	  <li><a href="#mainContent">skip to content</a></li>
	  <li><a href="#mainnav">skip to navigation</a></li>
  </ul>
  -->
  
  
      <%include file="/header.html"/>
     
       <%doc>
	      <%
	        user_logged_in = request.environ.get("repoze.who.identity")
	        showAdmin = False
	        if user_logged_in:
	            user_logged_in_name = user_logged_in['repoze.who.userid']
	            if 'permissions' in user_logged_in and 'administrator' in user_logged_in['permissions']:
	                showAdmin = 'admin'
	            elif 'permissions' in user_logged_in and 'manager' in user_logged_in['permissions']:
	                showAdmin = 'manage'
	        current_url = request.environ.get('PATH_INFO')
	      %> 
       </%doc>
      <nav>
<%doc>
<div id="login">


  % if user_logged_in_name:
    Welcome <a href="/users/${user_logged_in_name}">${user_logged_in_name}</a>   
    <a href="/logout_handler?came_from=${current_url}">Logout</a>
  % else:
    <a href="/login?came_from=${current_url}">Login</a>
  % endif



</div>
</%doc>
<%doc>
<span class="nonVis" >breadcrumb trail</span>
<ul class="breadcrumb" >
% if silo_name:
<li class="silo"><span>silo: </span><a href="/${silo_name}">${silo_name}</a>
% if ident and 'role' in ident and ident['role'] in ["admin", "manager"]:
  <a href="/${silo_name}/admin/">manage ${silo_name}</a>
% endif
</li>
% endif
 
% if id:
<li class="dataPackage"><span>data package: </span><a href="/${silo_name}/datasets/${id}">${id}</a></li>
% endif

% if path:
<%
paths = path.split('/')
path_url = "/%s/datasets/%s"%(silo_name,id)
%>
% for path in paths:
<% path_url = path_url + "/%s"%path %>
<li><a href="${path_url}">${path}</a></li>
% endfor
% endif
</ul>
</%doc>
</nav>



<div id="mainContent"  class="main">

    <article class="content" >

	<div class="wrapper row">
    ${self.body()}
      	</div>

    </article> 
    <div class="clear" ></div>

</div><!-- close .main -->

<footer class="site">
  <%include file="/footer.html"/>
</footer>
 </div> <!-- end page --> 
 
 
 <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["trackPageView"]);
  _paq.push(["enableLinkTracking"]);

  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://orastats.bodleian.ox.ac.uk/";
    _paq.push(["setTrackerUrl", u+"piwik.php"]);
    _paq.push(["setSiteId", "6"]);
    var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
    g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

  </body>
</html>
