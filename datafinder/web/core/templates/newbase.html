# -*- coding: utf-8 -*-
<!DOCTYPE html>

<!--[if lt IE 7 ]> <html lang="en" class="ie ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="ie ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="ie ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="ie ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> 
<html lang="en"> 
<!--<![endif]-->
<head> 

<meta charset="utf-8" /> 

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <!-- <title>DataFinder</title> -->
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="/static/foundation/stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="/static/foundation/stylesheets/foundation.min.css">
  <link rel="stylesheet" href="/static/foundation/stylesheets/app.css">

  <!-- Foundation css customised for DataFinder   -->
  <link rel="stylesheet" href="/static/foundation/stylesheets/foundation_enhance.css">

  <script src="/static/foundation/javascripts/modernizr.foundation.js"></script>

  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
   <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
   <script src="http://datafinder-d2v.bodleian.ox.ac.uk:8080/js/piwik.js></script>
  <!-- Included JS Files (Compressed) -->
  <script src="/static/foundation/javascripts/jquery.js"></script>
  <script src="/static/foundation/javascripts/foundation.min.js"></script>
  
  <!-- Initialize JS Plugins -->
  <script src="/static/foundation/javascripts/app.js"></script>
  
   <style>
	.ui-autocomplete {
	max-height: 100px;
	overflow-y: auto;
	/* prevent horizontal scrollbar */
	overflow-x: hidden;
	}
	/* IE 6 doesn't support max-height
	* we use height instead, but this forces the menu to always be this tall
	*/
	* html .ui-autocomplete {
	height: 100px;
	}
  </style>

  <script src="http://code.jquery.com/ui/1.8.2/jquery-ui.js"></script>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.2/themes/smoothness/jquery-ui.css" />
  <script>
     <!-- $(window).load(function(){
 $("#featured").orbit();
    }); -->
    </script> 
 <!-- <script type="text/javascript" src="/static/jquery.js"></script> -->

  ${self.head_tags()}
  
 <script type="text/javascript">

  $(document).ready( function() {
   var $=jQuery.noConflict(); 

  setUpExamplePage();
  setUpPage();
  
  $('#save').click( function()
	{
	    var actionURL = "/admin/save_source/";
	    $('#form1').attr('action', actionURL);  
	    $("#form1")[0].submit();    
	});

	var availableTags = [
	"ActionScript",
	"AppleScript",
	"Asp",
	"BASIC",
	"C",
	"C++",
	"Clojure",
	"COBOL",
	"ColdFusion",
	"Erlang",
	"Fortran",
	"Groovy",
	"Haskell",
	"Java",
	"JavaScript",
	"Lisp",
	"Perl",
	"PHP",
	"Python",
	"Ruby",
	"Scala",
	"Scheme"
	];
	$( "#pproject_desc" ).autocomplete({
	source: availableTags
	});

   $("#project_desc").autocomplete({
     //if ($(this).val().length >= 2 ) 
		  //{
			source: function( request, response ) 
			{	var list;	 
			  	 $.ajax({
			      url: "/contribute/projects/",
			      type: "POST",
			      data: "{'Project_ID':'1'}",
			      contentType: "application/json",
                  dataType: "json",
			      success: function(data)
				      {
				         response( data);
				      },
			      error:function()
				      {
				          alert("failure");
				      }   
			    });
		    } 	
	 }); 
	 
	 $("#main_language").autocomplete({
			source: function( request, response ) 
			{	 var list;	 
			     //if(request.term.length >= 2)
			  	 //{
				  	  $.ajax({
				      url: "/contribute/languages/?lang="+request.term,
				      type: "GET",
				      data: "{'Project_ID':'1'}",
				      contentType: "application/json",
	                  dataType: "json",
				      success: function(data)
					      {
					         response( data);
					      },
				      error:function()
					      {
					          alert("failure");
					      }   
					  });
				 //}
		    } 	
	 }); 
	 
	 $(".author_lastname_1").autocomplete({
			source: function( request, response ) 
			{	 var data_dict = {}
			     data_dict['lastname'] = request.term 
			     data_dict['firstname'] = $("#author_firstname_1").val() 
			     data_dict['middlename'] = $("#author_middlename_1").val() 
                 data_dict['email'] = $("#author_email_1").val() 
			     if(request.term.length >= 2)
			  	 {
				  	  $.ajax({
				      url: "/contribute/people/",
				      type: "POST",
				      data:  data_dict ,
				      contentType: "application/json",
	                  dataType: "json",
				      success: function(data)
					      {  if (data.firstname.length == 1)
					      		$("#author_firstname_1").val(data.firstname[0])
					      	 if (data.middlename.length == 1)
					      		$("#author_middlename_1").val(data.middlename[0])
					      	 if (data.email.length == 1)
					      		$("#author_email_1").val(data.email[0])
					         response( data.lastname);
					      },
				      error: function(jqXHR, textStatus, errorThrown)
				          {
  							alert(textStatus + errorThrown);
					   	  }  
					  });
				 }
		    } 	
	 }); 
	 
	  
	 $("#author_firstname_1").autocomplete({
			source: function( request, response ) 
			{	 var data_dict = {}
			     data_dict['lastname'] = $("#author_lastname_1").val()
			     data_dict['firstname'] =  request.term 
			     data_dict['middlename'] = $("#author_middlename_1").val() 
                 data_dict['email'] = $("#author_email_1").val() 
			     if(request.term.length >= 2)
			  	 {
				  	  $.ajax({
				      url: "/contribute/people/",
				      type: "POST",
				      data:  data_dict ,
				      contentType: "application/json",
	                  dataType: "json",
				      success: function(data)
					      { 
					      	 if (data.middlename.length == 1)
					      		$("#author_middlename_1").val(data.middlename[0])
					      	 if (data.email.length == 1)
					      		$("#author_email_1").val(data.email[0])
					      	 if (data.lastname.length == 1)
					      		$("#author_lastname_1").val(data.lastname[0])
					         response( data.firstname);
					      },
				      error: function(jqXHR, textStatus, errorThrown)
				          {
  							alert(textStatus + errorThrown);
					   	  }  
					  });
				 }
		    } 	
	 }); 
	 
	  $("#author_middlename_1").autocomplete({
			source: function( request, response ) 
			{	 var data_dict = {}
			     data_dict['lastname'] = $("#author_lastname_1").val()
			     data_dict['firstname'] = $("#author_firstname_1").val() 
			     data_dict['middlename'] =request.term 
                 data_dict['email'] = $("#author_email_1").val() 
			     if(request.term.length >= 2)
			  	 {
				  	  $.ajax({
				      url: "/contribute/people/",
				      type: "POST",
				      data:  data_dict ,
				      contentType: "application/json",
	                  dataType: "json",
				      success: function(data)
					      {  if (data.firstname.length == 1)
					      		$("#author_firstname_1").val(data.firstname[0])
					      	 if (data.email.length == 1)
					      		$("#author_email_1").val(data.email[0])
					      	 if (data.lastname.length == 1)
					      		$("#author_lastname_1").val(data.lastname[0])
					         response( data.middlename);
					      },
				      error: function(jqXHR, textStatus, errorThrown)
				          {
  							alert(textStatus + errorThrown);
					   	  }  
					  });
				 }
		    } 	
	 }); 
	 
 
	  $("#author_email_1").autocomplete({
			source: function( request, response ) 
			{	 var data_dict = {}
			     data_dict['lastname'] = $("#author_lastname_1").val()
			     data_dict['firstname'] = $("#author_firstname_1").val() 
			     data_dict['middlename'] = $("#author_middlename_1").val() 
                 data_dict['email'] = request.term 
			     if(request.term.length >= 2)
			  	 {
				  	  $.ajax({
				      url: "/contribute/people/",
				      type: "POST",
				      data:  data_dict ,
				      contentType: "application/json",
	                  dataType: "json",
				      success: function(data)
					      { 
					         if (data.firstname.length == 1)
					      		$("#author_firstname_1").val(data.firstname[0])
					      	 if (data.middlename.length == 1)
					      		$("#author_middlename_1").val(data.middlename[0])
					      	 if (data.lastname.length == 1)
					      		$("#author_lastname_1").val(data.lastname[0])
					         response( data.email);
					      },
				      error: function(jqXHR, textStatus, errorThrown)
				          {
  							alert(textStatus + errorThrown);
					   	  }  
					  });
				 }
		    } 	
	 }); 
	 
  $('#depositDataYes').change(function() 
    {
	    if($(this).val()=='yes') {   
	       $('#depositfileupload').removeAttr('disabled');

	    } else {
	       $('#depositfileupload').attr('disabled', 'disabled');
    } 
  });
    $('#depositDataNo').change(function() 
    {
	    if($(this).val()=='yes') {   
	       $('#depositfileupload').removeAttr('disabled');

	    } else {
	       $('#depositfileupload').attr('disabled', 'disabled');
    } 
  });
  
  $('#fundedResearch').click(function() 
    { 
	    if($(this).is(':checked')) {   	    
	             $('#fundedAgency').removeAttr('disabled');
	             $('#grantNumber').removeAttr('disabled');
	             $('#projectDesc').removeAttr('disabled');\
	             
	    } else {
	             $('#fundedAgency').attr('disabled', 'disabled');   
	    	     $('#grantNumber').attr('disabled', 'disabled');
	    	     $('#projectDesc').attr('disabled', 'disabled');
    } 
  });
  
  $('#register').click( function()
	{
	    var actionURL = "/admin/register_source/";
	    $('#form1').attr('action', actionURL);  
	    $("#form1")[0].submit();    
	});
  $('#activate').click( function()
	{
	    var actionURL =  "/admin/activate_source/";
	    $('#form1').attr('action', actionURL);
        $("#form1")[0].submit();    
	});

  $('a.delete').click( function() {
    var theAnchor = this;
    var redirectURL = $(this).attr('data-url');
    if ( confirm('Are you sure you want to delete this?' ) )
      $.ajax({
        type: 'DELETE',
        url: $(this).attr('href'),
        dataType: 'json',
        success: function() {
           
            var toRemove = $(theAnchor).attr('data-remove');
            $("#" + toRemove).remove();
            window.location.replace(redirectURL);
           
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) 
        {
          alert("Ooooops!, request failed with status: " + XMLHttpRequest.status + ' ' + XMLHttpRequest.responseText);
        }
      });
    return false;
  });
  
  $('#adduser').click( function()
	{   var user_sso_id =   $('#user_sso_id').val()
	    var actionURL = "/admin/users/add/?user_sso_id=" + user_sso_id;
	    $('#manageusers').attr('action', actionURL);  
	    $("#manageusers")[0].submit();    
	});
  $('#edituser').click( function()
	{   var user_sso_id =   $('#user_sso_id').val()
	    var actionURL = "/admin/users/edit/?user_sso_id=" + user_sso_id;
	    $('#manageusers').attr('action', actionURL);  
	    $("#manageusers")[0].submit();    
	});
	
  $('#deluser').click( function()
	{
	    var actionURL = "/admin/users/del/?user_sso_id=" + user_sso_id;
	    $('#manageusers').attr('action', actionURL);  
	    $("#manageusers")[0].submit();    
	});
	


});

	//search 

	function fhAdjust(){
		//Make sure facets do not stick beneath footer
		navh = document.getElementById('facet_wrapper').style.height;
		navh = navh + 211;
		wrah = document.getElementById('results-controls').style.height;
		if (navh > wrah)
		 {
			document.getElementById('results-controls').style.height =  navh + 100;
		}
		 else 
		{
			mainh = document.getElementById('mainContent').height;
			mainh = mainh + 91;
			if (mainh > navh){
				document.getElementById('results-controls').style.height = mainh + 100;
			} else {
				document.getElementById('results-controls').style.height =  navh + 100;
			}
		}
	}
	
	function bindItem(ind){  
		    //$('#fh' + ind).click(function(event) {
		    //$("[id^=fh]").click(function(event) {
		    //$('#fh1').click(function(event) {
			//event.preventDefault();
			//alert("i am here");
			//if ((document.getElementById('fl' + ind)).classList.contains("closed"))
			if((document.getElementById('fl' + ind)).className.match("closed"))
			{
				document.getElementById('fl' + ind).style.display = "block";
				//document.getElementById('fl' + ind).className.replace("closed"," ");
				document.getElementById('fl' + ind).className -= "closed";
				//document.getElementById('fl' + ind).className += " " + newClassName;
				//document.getElementById('fh' + ind).style.backgroundImage= "url('/static/styles/images/fminus.png')";
				//document.getElementById('fs' + ind).style.backgroundColor = "#A79D96";
			} 
			else 
			{
				document.getElementById('fl' + ind).style.display= "none";
				//document.getElementById('fl' + ind).classList.add ="closed";
				document.getElementById('fl' + ind).className += " " + "closed";
				//document.getElementById('fh' + ind).style.backgroundImage= "url('/static/styles/images/fplus.png')";
				//document.getElementById('fs' + ind).style.backgroundColor = "#999";
		  	}
			//fhAdjust();
	}
</script>

  <script src="/static/js/assignFASTPage.js" type="text/javascript"></script>
  <script src="/static/js/assignFASTExample.js" type="text/javascript"></script>
  <script src="/static/js/assignFASTGadget.js" type="text/javascript"></script> 
  <script src="/static/js/assignFASTComplete.js" type="text/javascript"></script>
  
 <!--[if lt IE 9]>

  <script type="text/javascript" src="/static/js/html5.js" />
  <![endif]-->
  
  <!-- auto-discovery link to sword service document -->
  <link rel="http://purl.org/net/sword/discovery/service-document" href="/swordv2/service-document"/>
  
  <!-- print stylesheet for print stlying -->
  <!-- <link media="print"  href="/static/styles/print.css" rel="stylesheet" type="text/css"/>-->
  
  
  <!-- general reset styles for getting rid of annoying browser defaults -->
  <!-- <link media="all"  href="/static/styles/reset.css" rel="stylesheet" type="text/css"/> -->

  <!-- basic styles suitable for all devices *DO NOT put layout stuff here * -->
  <!-- <link media="all"  href="/static/styles/basic.css" rel="stylesheet" type="text/css"/> -->

  <!-- styles for mobile devices-->
  <!-- <link href="/static/styles/marmoset.css" rel="stylesheet" type="text/css" media="screen and (max-width: 639px)"/> -->

  <!-- styles for smallscreen devices-->
  <!-- <link href="/static/styles/squirrelMonkey.css" rel="stylesheet" type="text/css" media="(min-width: 640px)"/> --> 


  <!-- styles for small-to-medium screen desktop  devices-->
  <!-- <link rel="stylesheet" type="text/css" href="/static/styles/chimpanzee.css"
media="(min-width: 1100px) and (max-width: 1600px)"/> -->


  <!-- styles for large screen desktop devices-->
  <!-- <link  rel="stylesheet" type="text/css" href="/static/styles/silverback.css" media="screen and (min-width: 1601px)"/> --> 


  <!-- styles for Internet explorer - imports the small/medium desktop stylesheet and contains  any ie-specific styles -->
  <!--[if (gt IE 4)&(lt IE 9)]>
    <link media="screen" href="/static/styles/ie.css" rel="stylesheet" type="text/css"/>
  <![endif]-->

<!-- encourage mobile devices to initially load the site without zooming out -->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<meta name="keywords" content="" />

<meta name="description" content="" />
 
  </head>
<body>
  <div id="page" >
  <!--
  <ul class="skipLinks">
	  <li><a href="#mainContent">skip to content</a></li>
	  <li><a href="#mainnav">skip to navigation</a></li>
  </ul>
  -->
  
  
      <%include file="/newheader.html"/>
     
       <%doc>
	      <%
	        user_logged_in = request.environ.get("repoze.who.identity")
	        showAdmin = False
	        if user_logged_in:
	            user_logged_in_name = user_logged_in['repoze.who.userid']
	            if 'permissions' in user_logged_in and 'administrator' in user_logged_in['permissions']:
	                showAdmin = 'admin'
	            elif 'permissions' in user_logged_in and 'manager' in user_logged_in['permissions']:
	                showAdmin = 'manage'
	        current_url = request.environ.get('PATH_INFO')
	      %> 
       </%doc>
      <nav>
<%doc>
<div id="login">


  % if user_logged_in_name:
    Welcome <a href="/users/${user_logged_in_name}">${user_logged_in_name}</a>   
    <a href="/logout_handler?came_from=${current_url}">Logout</a>
  % else:
    <a href="/login?came_from=${current_url}">Login</a>
  % endif



</div>
</%doc>
<%doc>
<span class="nonVis" >breadcrumb trail</span>
<ul class="breadcrumb" >
% if silo_name:
<li class="silo"><span>silo: </span><a href="/${silo_name}">${silo_name}</a>
% if ident and 'role' in ident and ident['role'] in ["admin", "manager"]:
  <a href="/${silo_name}/admin/">manage ${silo_name}</a>
% endif
</li>
% endif
 
% if id:
<li class="dataPackage"><span>data package: </span><a href="/${silo_name}/datasets/${id}">${id}</a></li>
% endif

% if path:
<%
paths = path.split('/')
path_url = "/%s/datasets/%s"%(silo_name,id)
%>
% for path in paths:
<% path_url = path_url + "/%s"%path %>
<li><a href="${path_url}">${path}</a></li>
% endfor
% endif
</ul>
</%doc>
</nav>



<div id="mainContent"  class="main">

    <article class="content" >

	<div class="wrapper row">
    ${self.body()}
      	</div>

    </article> 
    <div class="clear" ></div>

</div><!-- close .main -->

<footer class="site">
  <%include file="/newfooter.html"/>
</footer>
 </div> <!-- end page --> 
 
 <!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = "http://datafinder-d2v.bodleian.ox.ac.uk:8080/";
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://datafinder-d2v.bodleian.ox.ac.uk:8080/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

  </body>
</html>
